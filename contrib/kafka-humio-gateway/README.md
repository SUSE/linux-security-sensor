kafka-humio-gateway
===================

This project acts as a Kafka consumer and feeds events to a Humio ingestion endpoint.

Configuration
-------------

The configuration file is a simple Yaml file:

```
kafka:
  brokers:
    - broker1:9092
    - broker2:9092
    - ...
  topics:
    - event-named-in-plugin-parameters-1
    - event-named-in-plugin-parameters-2
    - ...
  consumer_group: unique-consumer-group-name
humio:
  endpoint_url: https://cloud.community.humio.com:443/api/v1/ingest/humio-structured
  ingest_token: your-ingest-token
```

Every field except `consumer_group` is required.

Transformations
---------------

The events generated by Velociraptor may need transformation to be ingested by Humio.

The Humio structured data API requires events be POSTed with the following JSON schema:

```
[{
	"tags" : {
		"tag1" : "value1",
		"tag2" : "value2"
	}, events : [
		{
			"attributes" : { ... attributes ... },
			"timestamp: : <timestamp>,
			"timezone" : "UTC"
		},
		{ zero or more events  }
	]
}]
```


The JSON provided by the Kafka exporter in Velociraptor has the following JSON schema:
{
	"version" : 1,
	"row_data" :
		{ ... attributes },
	"tags" :
		{ ... zero or more tags }
}

The row data is provided as generated by the query.  The version is hard-coded by Velociraptor.  As of this writing there is only version 1.  If the query was generated by a client artifact, tags will automatically contain "ClientId" and "ClientHostname" tags.  Other tags can be provided using the parameters to the `kafka_publisher` plugin in Velociraptor.

