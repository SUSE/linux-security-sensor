name: SUSE.Linux.Events.ImmutableFile

description: |
   Print events when a file gets the IMMUTABLE flag changed

type: CLIENT_EVENT

precondition: SELECT OS From info() where OS = 'linux'

sources:
  - query: |
      LET events = SELECT
        *,
        hash(path=Path, hashselect=["SHA1", "SHA256"]) as hashes
      FROM chattrsnoop()

      SELECT
        Timestamp,
        Path,
        Dir,
        Action,
        hashes.SHA256 AS SHA256,
        hashes.SHA1 AS SHA1
      FROM events
